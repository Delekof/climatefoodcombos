<!DOCTYPE html>
<html>
<head>
  <title>Climate Food Combos</title>
  <script src="https://cdn.jsdelivr.net/gh/Delekof/climatefoodcombos/data.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>Climate Food Combos</h1>

<div class="slidecontainer">
  <p>Protein supply:</p>
  <input type="range" min="50" max="200" value="115" class="slider" id="proteinRange">
  <input type="number" min="50" max="200" value="115" id="proteinInput">
</div>

<div class="slidecontainer">
  <p>Calorie supply:</p>
  <input type="range" min="2000" max="4000" value="3500" class="slider" id="calorieRange">
  <input type="number" min="2000" max="4000" value="3500" id="calorieInput">
</div>

<div class="slidecontainer">
  <p>"Empty" calories:</p>
  <input type="range" min="0" max="2000" value="1200" class="slider" id="emptycalorieRange">
  <input type="number" min="0" max="2000" value="1200" id="emptycalorieInput">
</div>

<div>
  <p>"Nutritious" calories supply from protein: <span id="proteinpercalorieSupply"></span></p>
</div>

<button type="button" onclick="displayProteinFoods()">
  Click me to display how much of your calories should come from tofu.
</button>

<p id="demo1"></p>

<button type="button" onclick="displayCarbFoods()">
  Click me to display how much of your calories should come from bread.
</button>

<p id="demo2"></p>

<script>
  function calculateProteinPerKcal(data) {
    for (let food in data) {
      let protein = data[food].protein;
      let kcal = data[food].kcal;
      data[food].protein_per_kcal = parseFloat((protein / kcal).toFixed(2));
    }
  }

  function displayProteinFoods() {
    let proteinRatio = calculateProteinRatio("Tofu", "Bread", (proteinRange.value / (calorieRange.value - emptycalorieRange.value)))
    document.getElementById('demo1').innerHTML = String((100*proteinRatio).toFixed(0))+"%";
  }

  function displayCarbFoods() {
    let carbRatio = 1 - calculateProteinRatio("Tofu", "Bread", (proteinRange.value / (calorieRange.value - emptycalorieRange.value)))
    document.getElementById('demo2').innerHTML = String((100*carbRatio).toFixed(0))+"%";
  }

  var proteinRange = document.getElementById("proteinRange");
  var proteinInput = document.getElementById("proteinInput");

  var calorieRange = document.getElementById("calorieRange");
  var calorieInput = document.getElementById("calorieInput");

  var emptycalorieRange = document.getElementById("emptycalorieRange");
  var emptycalorieInput = document.getElementById("emptycalorieInput");

  var proteinPerCalorieSupply = document.getElementById("proteinpercalorieSupply");

  proteinPerCalorieSupply.innerHTML = String((100 * 4 * proteinRange.value / (calorieRange.value - emptycalorieRange.value)).toFixed(2)) + "%";

  function updateProteinSupply() {
    proteinInput.value = proteinRange.value;
    updateProteinPerCalorieSupply();
  }

  function updateCalorieSupply() {
    calorieInput.value = calorieRange.value;
    updateProteinPerCalorieSupply();
  }

  function updateEmptyCalorieSupply() {
    emptycalorieInput.value = emptycalorieRange.value;
    updateProteinPerCalorieSupply();
  }

  function updateProteinPerCalorieSupply() {
    proteinPerCalorieSupply.innerHTML = String((100 * 4 * proteinRange.value / (calorieRange.value - emptycalorieRange.value)).toFixed(2)) + "%";
  }

  proteinRange.oninput = updateProteinSupply;
  calorieRange.oninput = updateCalorieSupply;
  emptycalorieRange.oninput = updateEmptyCalorieSupply;

  proteinInput.onblur = function() {
    proteinRange.value = this.value;
    updateProteinSupply();
  }

  calorieInput.onblur = function() {
    calorieRange.value = this.value;
    updateCalorieSupply();
  }

  emptycalorieInput.onblur = function() {
    emptycalorieRange.value = this.value;
    updateEmptyCalorieSupply();
  }

  proteinInput.addEventListener("keydown", function(event) {
    if (event.keyCode === 13) {
      this.blur();
    }
  });

  calorieInput.addEventListener("keydown", function(event) {
    if (event.keyCode === 13) {
      this.blur();
    }
  });

  emptycalorieInput.addEventListener("keydown", function(event) {
    if (event.keyCode === 13) {
      this.blur();
    }
  });

  function calculateProteinRatio(proteinFood, carbFood, kappa) {
    let kappac = nutritional_data[carbFood].protein_per_kcal
    let kappap = nutritional_data[proteinFood].protein_per_kcal
    console.log(kappac, kappap, kappa)
    return ((kappa - kappac)/(kappap - kappac))
  }

  // Ensure external data is processed correctly
  calculateProteinPerKcal(nutritional_data);

</script>

</body>
</html>
